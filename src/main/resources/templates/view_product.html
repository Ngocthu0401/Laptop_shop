<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base::Layout(~{::section})}">
<head>
    <meta charset="UTF-8">
    <title>Product Detail</title>
</head>
<body>
<section>
    <div class="container card-sh"
         style="margin-top: 70px; margin-bottom: 100px">

        <div class="col-md-12 p-5">
            <div class="row">
                <th:block th:if="${session.succMsg}">
                    <p class="text-success alert alert-success text-center" role="alert">[[${session.succMsg}]]</p>
                    <th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
                </th:block>

                <th:block th:if="${session.errorMsg}">
                    <p class="text-danger text-center alert alert-danger">[[${session.errorMsg}]]</p>
                    <th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
                </th:block>
                <div class="col-md-6 text-end">
                    <img alt="" th:src="@{'/img/product_img/'+${product.image}}" width="330px"
                         height="400px">
                </div>

                <div class="col-md-6">

                    <p class="fs-3">[[${product.title}]]</p>
                    <p>
                        <span class="fw-bold">Description : </span><br>[[${product.description}]]
                    </p>
                    <p>
                        <span class="fw-bold"> Product Details: </span> <br> Status
                        :
                        <th:block th:if="${product.stock>0}">
                            <span class="badge bg-success">Available</span>
                        </th:block>

                        <th:block th:unless="${product.stock>0}">
                            <span class="badge bg-warning">Out of Stock</span>
                        </th:block>


                        <br> Category: [[${product.category}]]<br> Policy : 7
                        Days Replacement & Return
                    </p>
                    <p class="fs-5 fw-bold">
                        Price :&nbsp; &nbsp; &nbsp; &nbsp;
                        [[${product.discountPrice}]] <span
                            class="fs-6 text-decoration-line-through text-secondary">[[${product.price}]]</span>
                        <span class="fs-6 text-success">[[${product.discount}]]%
								off</span>
                    </p>

                    <div class="row">
                        <div class="col-md-4 text-success text-center p-2">
                            <i class="fas fa-money-bill-wave fa-2x"></i>
                            <p>Cash On Delivery</p>
                        </div>
                        <div class="col-md-4 text-danger text-center p-2">
                            <i class="fas fa-undo-alt fa-2x"></i>
                            <p>Return Available</p>
                        </div>
                        <div class="col-md-4 text-primary text-center p-2">
                            <i class="fas fa-truck-moving fa-2x"></i>
                            <p>Free Shipping</p>
                        </div>
                    </div>

                    <th:block th:if="${product.stock>0}">
                        <th:block th:if="${user==null}">
                            <a href="/signin" class="btn btn-danger col-md-12">Add To Cart</a>
                        </th:block>

                        <th:block th:unless="${user==null}">
                            <a
                                    th:href="@{'/user/addCart?pid='+${product.id}+'&uid='+${user.id}}"
                                    class="btn btn-danger col-md-12">Add To Cart</a>
                        </th:block>

                    </th:block>

                    <th:block th:unless="${product.stock>0}">
                        <a href="#" class="btn text-white btn-warning col-md-12">Out
                            of Stock</a>
                    </th:block>

                </div>
            </div>
        </div>


        <div class="reviews mt-5">
            <h3>Reviews:</h3>
            <ul>
                <!-- Nếu không có đánh giá nào -->
                <th:block th:if="${reviews == null || reviews.isEmpty()}">
                    <p>No reviews yet.</p>
                </th:block>

                <!-- Nếu có đánh giá -->
                <th:block th:if="${reviews != null && !reviews.isEmpty()}">
                    <li th:each="review : ${reviews}">
                        <p><strong th:text="${review.user.name}">User Name</strong> - Rating:
                        <div class="star-rating">
                            <i class="fas fa-star" th:classappend="${review.rating >= 1 ? 'text-warning' : ''}"></i>
                            <i class="fas fa-star" th:classappend="${review.rating >= 2 ? 'text-warning' : ''}"></i>
                            <i class="fas fa-star" th:classappend="${review.rating >= 3 ? 'text-warning' : ''}"></i>
                            <i class="fas fa-star" th:classappend="${review.rating >= 4 ? 'text-warning' : ''}"></i>
                            <i class="fas fa-star" th:classappend="${review.rating >= 5 ? 'text-warning' : ''}"></i>
                        </div>
                        </p>
                        <p th:text="${review.comment}">Review Comment</p>
                        <p><em>Posted on: <span th:text="${#dates.format(review.reviewDate, 'dd-MM-yyyy')}">Review Date</span></em></p>
                    </li>
                </th:block>
            </ul>
        </div>

        <form th:action="@{/user/submit-review}" method="post" id="reviewForm">
            <input type="hidden" name="productId" th:value="${product.id}">
            <label for="rating">Rating:</label>
            <div class="star-rating" style="cursor: pointer;">
                <i class="fas fa-star" data-value="1" style="font-size: 1.5rem; color: #ccc; transition: color 0.2s;"></i>
                <i class="fas fa-star" data-value="2" style="font-size: 1.5rem; color: #ccc; transition: color 0.2s;"></i>
                <i class="fas fa-star" data-value="3" style="font-size: 1.5rem; color: #ccc; transition: color 0.2s;"></i>
                <i class="fas fa-star" data-value="4" style="font-size: 1.5rem; color: #ccc; transition: color 0.2s;"></i>
                <i class="fas fa-star" data-value="5" style="font-size: 1.5rem; color: #ccc; transition: color 0.2s;"></i>
            </div>
            <input type="hidden" id="rating" name="rating" value="0">

            <label for="comment">Your Review:</label>
            <textarea id="comment" name="comment" required></textarea>

            <button type="submit">Submit Review</button>
        </form>


    </div>
</section>


</body>
</html>
